# Optimal Control of a Flexible Robotic Link
### Group 23 - Course Project
**Course:** Optimal Control and Reinforcement Learning (2025/2026)

## Project Overview
This project involves the modeling, trajectory optimization, and feedback control of a flexible robotic link. The system is modeled as a planar **double pendulum with nonlinear rotational stiffness** acting on the second joint, simulating a flexible link manipulator.

The project is divided into sequential tasks ranging from dynamics modeling to Model Predictive Control (MPC) and realistic animation.

## Authors
* **Alessandro Binci**
* **Alessandro Tampieri**
* **Lorenzo Tucci**

---

## Repository Structure

### Source Code (`src/`)
* `dynamics.py`: Discrete-time dynamics (Forward Euler) and symbolic Jacobians using **SymPy**.
* `cost.py`: Cost function definitions (Stage cost and Terminal cost) and their gradients.
* `equilibrium.py`: Computation of equilibrium configurations $(x_{eq}, u_{eq})$.
* `reference_curve.py`: Generation of reference trajectories (Step and Trapezoidal/Smooth).
* `ltv_solver_LQR.py`: Implementation of the Time-Varying LQR solver (Riccati Equation).
* `solver_MPC.py`: Linear MPC solver implemented using **CasADi**.

### Executables
* `main_task1.py`: Trajectory generation via Newton's Method (Step Reference).
* `main_task2.py`: Trajectory generation via Newton's Method (Smooth Reference - Trapezoidal trajectory).
* `main_task3.py`: Tracking control via Time-Varying LQR (TV-LQR).
* `main_task4.py`: Tracking control via Linear Model Predictive Control (MPC).
* `main_task5.py`: Realistic animation of the system.

### Output
* `images/`: Contains all the plots generated by the tasks (States, Inputs, Errors, Animations).
* `*.npy`: Data files storing optimal trajectories (generated by Task 2, used by Tasks 3, 4, 5).

---
## Task settings

### Task 1

- Set Trajectory Duration: Decide the duration in seconds of the trajectory setting **tf** in *reference_curve.py*.
- Set Initial Angle: Adjust the starting angle for the computation of the equilibria changing **th1_init** in *main_task1.py* and *main_task2.py*.
- Set desired torque for the first equilibrium point: Adjust the desired input torque for the computation of the first equilibrium changing **tau1_des** in *main_task1.py* and *main_task2.py*.
- Set Final Angle: Adjust the final angle ${\theta}_1$ for the computation of the second equilibrium changing **th1_final** in *main_task1.py* and *main_task2.py*.
- Cost Modifications: To change costs for the Newton's-like algorithm:
  - Open *cost.py* and adjust:
    - **Q1**: Cost for ${\theta}_1$.
    - **Q2**: Cost for ${\theta}_2$.
    - **Q3**: Cost for the derivative of ${\theta}_1$.
    - **Q4**: Cost for the derivative of ${\theta}_2$.
    - **RR**: Cost for the input.

### Task 2

- Simulation Time Adjustment: Open *reference_curve.py* and modify the smooth trapezoidal transition duration:
  - Adjust **t_init** to set the smooth transition starting time in seconds.
  - Adjust **t_end** to set the smooth transition ending time in seconds.
  - *Hint*: It's recommendable to define the smooth trajectory duration as multiple of 3 and not so long wrt the total duration of the trajectory.
---

### Task 3

- Cost Modifications: To change costs for the LQR:
  - Open *main_task3.py* and adjust:
    - **QQreg**: Cost for the states. 
    - **QQreg_final**: Cost for the states at final time T.
    - **RRreg**: Cost for the input.
    - **SSreg**: Set as array of zeros.
    - **qq_reg**, **rr_reg**: Cost affine terms 
    - **qq_Terminal**: Cost affine terms at final time T.
- Plotting are activated automatically.

### Task 4

- Defining cost matrices as for task 3.
- Set Time Window duration: Set the time window duration changing **T_window** in *main_task4.py*.
- Set Input Constraints: Change **uu_max** and **uu_min** in *main_task5.py* to define the admissible value range for the input.
- Plotting are activated automatically.

### Task 5

- No configuration is required, simply run *main_task5.py*.

## Installation & Requirements

The project requires **Python 3.x** and the following libraries.
Note that **CasADi** is required for the MPC task.

```bash
pip install numpy scipy matplotlib sympy casadi
```
---
*Reference: Optimal Control Course Project #2 - First Semester - Academic Year 2025/2026*